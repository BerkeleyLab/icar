**The Intermediate Complexity Atmospheric Research Model (ICAR)**

*Ethan Gutmann*

*Gutmann, E. D., J. R. Arnold, I. Barstad, M. P. Clark, and R. M. Rasmussen (2015), The Intermediate Complexity Atmospheric Research Model, J. Hydrometeor, in revision.*

ICAR is a simplified atmospheric model designed primarily for climate downscaling and atmospheric sensitivity tests, though it may have many other uses. 

To run the model 3D time-varying atmospheric data are required, though an ideal test case can be generated by the code for simple simulations as well.  

---------------------------------------------------------------------------------
Compiling the model: 
---------------------------------------------------------------------------------
    
    Edit the makefile to set the path to your compiled NetCDF and FFTW libraries
    
    Also to set the compiler for your machine if necessary
        defaults to gfortran I think...
    
    make clean
        remove build by-products
        
    make
        default (relatively high) optimization compile 
    
    make install
        compile if necessary, then install in the install directory [~/bin]
    
    options: 
        MODE=fast           more optimization, slower compile, WARNING:not safe optimizations
        MODE=profile        set profiling options for gnu compiler in particular
        MODE=debug          debug compile with optimizations
        MODE=debugslow      debug compile w/o optimizations
        MODE=debugomp       debug compile with optimizations and OpenMP parallelization
        MODE=debugompslow   debug compile w/o optimizations but with OpenMP parallelization

    make test
        compiles various test programs (mpdata_test, fftshift_test, and calendar_test)
    
    add -jn to parallelize the compile over n processors 
    
    example:
        make MODE=debug -j4 uses 4 processes to compile in debug mode

---------------------------------------------------------------------------------
Running the model: 
---------------------------------------------------------------------------------

Required Input files/variables

    icar_options.nml [other filename can be specified on the commandline e.g. icar your_options_file]
        This file specifies all other files and options.  See the example in run/icar_options.nml
    
    Necessary netcdf files: 
        Boundary/Initial conditions in e.g. wrf output files
            must [optionally] contain QVAPOR, T, P, [PB], U, V, HGT, Z, LAT, LONG, 
            [QCLOUD], [QICE], [LATV], [LONGV], [LATU], [LONGU]
        Hi resolution DEM in e.g. high-res wrf input or output file
            must contain HGT, LAT, LONG, and be in a nearly constant dx projection 
            (e.g. Lambert Conformal Conic)
            
    NOTE namelist file in git repo is not always in sync with code!
        This really just means it may not include all current options, it will usually run. 


---------------------------------------------------------------------------------
Common errors:
---------------------------------------------------------------------------------
1) Segmentation fault:
    Most likely due to your shell's stacksize limit (particularly with ifort). 
    
    To fix it run the following: 
    in bash:
        ulimit -s unlimited
    in csh: 
        unlimit stacksize
        
    NOTE: Some systems have a hard limit of 64MB (ulimit -s 65532), this is *probably* enough. 
Reference: https://software.intel.com/en-us/articles/determining-root-cause-of-sigsegv-or-sigbus-errors
